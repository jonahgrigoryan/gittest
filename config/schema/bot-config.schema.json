{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "BotConfig",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "compliance",
    "vision",
    "gto",
    "agents",
    "strategy",
    "execution",
    "safety",
    "logging",
    "evaluation"
  ],
  "properties": {
    "compliance": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "gameType",
        "blinds",
        "allowedEnvironments",
        "siteAllowlist"
      ],
      "properties": {
        "gameType": {
          "type": "string",
          "enum": [
            "HU_NLHE",
            "NLHE_6max"
          ]
        },
        "blinds": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "small",
            "big"
          ],
          "properties": {
            "small": {
              "type": "number",
              "minimum": 0
            },
            "big": {
              "type": "number",
              "minimum": 0
            },
            "ante": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "allowedEnvironments": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": [
              "private_sim",
              "owned_table",
              "api_permitted"
            ]
          }
        },
        "siteAllowlist": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "default": []
        }
      }
    },
    "vision": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "layoutPack",
        "dpiCalibration",
        "confidenceThreshold",
        "occlusionThreshold"
      ],
      "properties": {
        "layoutPack": {
          "type": "string",
          "minLength": 1
        },
        "dpiCalibration": {
          "type": "number",
          "minimum": 0
        },
        "confidenceThreshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "occlusionThreshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "gto": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "cachePath",
        "subgameBudgetMs",
        "deepStackThreshold"
      ],
      "properties": {
        "cachePath": {
          "type": "string",
          "minLength": 1
        },
        "subgameBudgetMs": {
          "type": "number",
          "minimum": 0
        },
        "deepStackThreshold": {
          "type": "number",
          "minimum": 0
        }
      }
    },
    "agents": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "models",
        "timeoutMs",
        "outputSchema",
        "costPolicy",
        "circuitBreaker"
      ],
      "properties": {
        "models": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "name",
              "provider",
              "modelId",
              "persona",
              "promptTemplate"
            ],
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1
              },
              "provider": {
                "type": "string",
                "enum": [
                  "openai",
                  "anthropic",
                  "local"
                ]
              },
              "modelId": {
                "type": "string",
                "minLength": 1
              },
              "persona": {
                "type": "string",
                "minLength": 1
              },
              "promptTemplate": {
                "type": "string",
                "minLength": 1
              }
            }
          },
          "default": []
        },
        "timeoutMs": {
          "type": "number",
          "minimum": 0
        },
        "outputSchema": {
          "type": "object"
        },
        "weightStorePath": {
          "type": "string",
          "minLength": 1
        },
        "costPolicy": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "maxTokensDecision",
            "maxTokensDay",
            "maxLatencyMs",
            "consecutiveFailureThreshold",
            "recoveryHands"
          ],
          "properties": {
            "maxTokensDecision": {
              "type": "integer",
              "minimum": 0
            },
            "maxTokensDay": {
              "type": "integer",
              "minimum": 0
            },
            "maxLatencyMs": {
              "type": "integer",
              "minimum": 0
            },
            "consecutiveFailureThreshold": {
              "type": "integer",
              "minimum": 1
            },
            "recoveryHands": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "circuitBreaker": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "consecutiveFailureThreshold",
            "cooldownHands"
          ],
          "properties": {
            "consecutiveFailureThreshold": {
              "type": "integer",
              "minimum": 1
            },
            "cooldownHands": {
              "type": "integer",
              "minimum": 1
            },
            "minCooldownMs": {
              "type": "number",
              "minimum": 0
            }
          }
        },
        "personaOverrides": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "description": {
                "type": "string"
              },
              "promptTemplate": {
                "type": "string"
              },
              "maxTokens": {
                "type": "integer",
                "minimum": 1
              },
              "temperature": {
                "type": "number",
                "minimum": 0
              },
              "topP": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "stopSequences": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "styleHints": {
                "type": "object",
                "additionalProperties": true
              }
            }
          },
          "default": {}
        }
      }
    },
    "strategy": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "alphaGTO",
        "betSizingSets",
        "divergenceThresholdPP"
      ],
      "properties": {
        "alphaGTO": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "betSizingSets": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "preflop",
            "flop",
            "turn",
            "river"
          ],
          "properties": {
            "preflop": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "number",
                "minimum": 0
              }
            },
            "flop": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "number",
                "minimum": 0
              }
            },
            "turn": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "number",
                "minimum": 0
              }
            },
            "river": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "number",
                "minimum": 0
              }
            }
          }
        },
        "divergenceThresholdPP": {
          "type": "number",
          "minimum": 0
        },
        "opponentModeling": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "minHands": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    },
    "execution": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "enabled",
        "mode",
        "verifyActions",
        "maxRetries",
        "verificationTimeoutMs"
      ],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "mode": {
          "type": "string",
          "enum": [
            "simulator",
            "api",
            "research-ui"
          ],
          "default": "simulator"
        },
        "verifyActions": {
          "type": "boolean",
          "default": true
        },
        "maxRetries": {
          "type": "integer",
          "minimum": 0,
          "default": 1
        },
        "verificationTimeoutMs": {
          "type": "integer",
          "minimum": 0,
          "default": 2000
        },
        "simulatorEndpoint": {
          "type": "string",
          "format": "uri",
          "default": "http://localhost:8080/api"
        },
        "researchUI": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "allowlist": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1
              },
              "default": []
            },
            "prohibitedSites": {
              "type": "array",
              "items": {
                "type": "string",
                "minLength": 1
              },
              "default": []
            },
            "requireBuildFlag": {
              "type": "boolean",
              "default": true
            }
          }
        }
      }
    },
    "safety": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "bankrollLimit",
        "sessionLimit",
        "panicStopConfidenceThreshold",
        "panicStopConsecutiveFrames"
      ],
      "properties": {
        "bankrollLimit": {
          "type": "number",
          "minimum": 0
        },
        "sessionLimit": {
          "type": "number",
          "minimum": 0
        },
        "panicStopConfidenceThreshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "panicStopConsecutiveFrames": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "logging": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "enabled",
        "outputDir",
        "flushIntervalMs",
        "maxFileSizeMb",
        "retentionDays",
        "exportFormats",
        "redaction",
        "metrics"
      ],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "outputDir": {
          "type": "string",
          "minLength": 1
        },
        "sessionPrefix": {
          "type": "string"
        },
        "flushIntervalMs": {
          "type": "integer",
          "minimum": 50
        },
        "maxFileSizeMb": {
          "type": "integer",
          "minimum": 1
        },
        "retentionDays": {
          "type": "integer",
          "minimum": 0
        },
        "exportFormats": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "enum": [
              "json",
              "acpc"
            ]
          }
        },
        "redaction": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "enabled",
            "fields"
          ],
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "fields": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "playerNames",
                  "ids",
                  "ipAddresses",
                  "reasoning"
                ]
              },
              "default": []
            }
          }
        },
        "metrics": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "enabled",
            "windowHands"
          ],
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "windowHands": {
              "type": "integer",
              "minimum": 1
            }
          }
        }
      }
    },
    "monitoring": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "health",
        "observability"
      ],
      "properties": {
        "health": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "intervalMs",
            "degradedThresholds",
            "safeMode",
            "panicStop",
            "dashboard"
          ],
          "properties": {
            "intervalMs": {
              "type": "integer",
              "minimum": 1000,
              "default": 5000
            },
            "degradedThresholds": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "visionConfidenceMin": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "default": 0.99
                },
                "solverLatencyMs": {
                  "type": "integer",
                  "minimum": 0,
                  "default": 800
                },
                "executorFailureRate": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "default": 0.2
                }
              }
            },
            "safeMode": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": { "type": "boolean", "default": true },
                "autoExitSeconds": { "type": "integer", "minimum": 0 }
              }
            },
            "panicStop": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "visionConfidenceFrames": { "type": "integer", "minimum": 1, "default": 3 },
                "minConfidence": { "type": "number", "minimum": 0, "maximum": 1, "default": 0.99 },
                "riskGuardAutoTrip": { "type": "boolean", "default": true }
              }
            },
            "dashboard": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": { "type": "boolean", "default": false },
                "port": { "type": "integer", "minimum": 1024, "default": 7777 },
                "authToken": { "type": "string" }
              }
            }
          }
        },
        "observability": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "logs",
            "metrics",
            "alerts"
          ],
          "properties": {
            "logs": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "level",
                "sinks"
              ],
              "properties": {
                "level": {
                  "type": "string",
                  "enum": [
                    "debug",
                    "info",
                    "warn",
                    "error",
                    "critical"
                  ],
                  "default": "info"
                },
                "sinks": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "console": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "enabled": { "type": "boolean", "default": true },
                        "level": {
                          "type": "string",
                          "enum": [
                            "debug",
                            "info",
                            "warn",
                            "error",
                            "critical"
                          ]
                        }
                      }
                    },
                    "file": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "enabled": { "type": "boolean", "default": false },
                        "level": {
                          "type": "string",
                          "enum": [
                            "debug",
                            "info",
                            "warn",
                            "error",
                            "critical"
                          ]
                        },
                        "outputDir": { "type": "string", "minLength": 1 },
                        "maxFileSizeMb": { "type": "integer", "minimum": 1, "default": 50 },
                        "maxFiles": { "type": "integer", "minimum": 1, "default": 10 }
                      }
                    },
                    "webhook": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "enabled": { "type": "boolean", "default": false },
                        "level": {
                          "type": "string",
                          "enum": [
                            "debug",
                            "info",
                            "warn",
                            "error",
                            "critical"
                          ]
                        },
                        "url": { "type": "string", "format": "uri" },
                        "headers": {
                          "type": "object",
                          "additionalProperties": { "type": "string" }
                        },
                        "batchSize": { "type": "integer", "minimum": 1, "default": 10 },
                        "retry": {
                          "type": "object",
                          "additionalProperties": false,
                          "properties": {
                            "attempts": { "type": "integer", "minimum": 1, "default": 3 },
                            "backoffMs": { "type": "integer", "minimum": 0, "default": 1000 }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "metrics": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "flushIntervalMs",
                "maxRecentHands",
                "emitHandSummaries"
              ],
              "properties": {
                "flushIntervalMs": { "type": "integer", "minimum": 1000, "default": 5000 },
                "maxRecentHands": { "type": "integer", "minimum": 10, "default": 100 },
                "emitHandSummaries": { "type": "boolean", "default": false }
              }
            },
            "alerts": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "enabled",
                "cooldownMs",
                "channels",
                "triggers"
              ],
              "properties": {
                "enabled": { "type": "boolean", "default": false },
                "cooldownMs": { "type": "integer", "minimum": 0, "default": 60000 },
                "channels": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["id", "type", "enabled"],
                    "properties": {
                      "id": { "type": "string", "minLength": 1 },
                      "type": {
                        "type": "string",
                        "enum": ["console", "file", "webhook"]
                      },
                      "enabled": { "type": "boolean", "default": true },
                      "level": {
                        "type": "string",
                        "enum": [
                          "debug",
                          "info",
                          "warn",
                          "error",
                          "critical"
                        ]
                      },
                      "path": { "type": "string" },
                      "url": { "type": "string", "format": "uri" },
                      "headers": {
                        "type": "object",
                        "additionalProperties": { "type": "string" }
                      },
                      "batchSize": { "type": "integer", "minimum": 1 }
                    }
                  }
                },
                "triggers": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": [
                    "panicStop",
                    "safeMode",
                    "solverTimeouts",
                    "agentCost",
                    "healthDegradedMs"
                  ],
                  "properties": {
                    "panicStop": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "id": { "type": "string" },
                        "enabled": { "type": "boolean", "default": true },
                        "cooldownMs": { "type": "integer", "minimum": 0, "default": 60000 },
                        "threshold": { "type": ["number", "integer"] }
                      }
                    },
                    "safeMode": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "id": { "type": "string" },
                        "enabled": { "type": "boolean", "default": true },
                        "cooldownMs": { "type": "integer", "minimum": 0, "default": 60000 },
                        "threshold": { "type": ["number", "integer"] }
                      }
                    },
                    "solverTimeouts": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "id": { "type": "string" },
                        "enabled": { "type": "boolean", "default": true },
                        "cooldownMs": { "type": "integer", "minimum": 0, "default": 60000 },
                        "threshold": { "type": ["number", "integer"] },
                        "windowHands": { "type": "integer", "minimum": 1, "default": 5 }
                      }
                    },
                    "agentCost": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "id": { "type": "string" },
                        "enabled": { "type": "boolean", "default": true },
                        "cooldownMs": { "type": "integer", "minimum": 0, "default": 60000 },
                        "threshold": { "type": "number", "minimum": 0 }
                      }
                    },
                    "healthDegradedMs": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "id": { "type": "string" },
                        "enabled": { "type": "boolean", "default": true },
                        "cooldownMs": { "type": "integer", "minimum": 0, "default": 60000 },
                        "threshold": { "type": ["number", "integer"] }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "evaluation": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "opponents",
        "smoke",
        "offline",
        "shadow",
        "abTest"
      ],
      "properties": {
        "opponents": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "id",
              "label",
              "style",
              "aggressionFactor",
              "bluffFrequency"
            ],
            "properties": {
              "id": { "type": "string", "minLength": 1 },
              "label": { "type": "string", "minLength": 1 },
              "description": { "type": "string" },
              "style": {
                "type": "string",
                "enum": [
                  "tight_aggressive",
                  "loose_passive",
                  "mixed_gto",
                  "baseline_proxy"
                ]
              },
              "aggressionFactor": { "type": "number", "minimum": 0 },
              "bluffFrequency": { "type": "number", "minimum": 0, "maximum": 1 }
            }
          }
        },
        "smoke": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "maxHands",
            "opponents"
          ],
          "properties": {
            "maxHands": { "type": "integer", "minimum": 1 },
            "opponents": {
              "type": "array",
              "items": { "type": "string" },
              "minItems": 1
            },
            "seed": { "type": "integer", "minimum": 0 }
          }
        },
        "offline": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "maxHands",
            "checkpointHands"
          ],
          "properties": {
            "maxHands": { "type": "integer", "minimum": 1000 },
            "checkpointHands": { "type": "integer", "minimum": 1000 }
          }
        },
        "shadow": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "defaultResultsDir"
          ],
          "properties": {
            "defaultResultsDir": { "type": "string", "minLength": 1 }
          }
        },
        "abTest": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "maxHands",
            "confidence"
          ],
          "properties": {
            "maxHands": { "type": "integer", "minimum": 1000 },
            "confidence": { "type": "number", "minimum": 0.5, "maximum": 0.999 }
          }
        }
      }
    }
  }
}
